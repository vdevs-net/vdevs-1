!function(a){"use strict";var b=function(a,c){var d=/[^\w\-\.:]/.test(a)?new Function(b.arg+",t","var _e=t.encode"+b.helper+",_s='"+a.replace(b.regexp,b.func)+"';return _s;"):b.cache[a]=b.cache[a]||b(b.load(a));return c?d(c,b):function(a){return d(a,b)}};b.cache={},b.load=function(a){return document.getElementById(a).innerHTML},b.regexp=/([\s'\\])(?!(?:[^{]|\{(?!%))*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,b.func=function(a,b,c,d,e,f){return b?{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[b]||"\\"+b:c?"="===c?"'+_e("+d+")+'":"'+("+d+"==null?'':"+d+")+'":e?"';":f?"_s+='":void 0},b.encReg=/[<>&"'\x00]/g,b.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},b.encode=function(a){return(null==a?"":""+a).replace(b.encReg,function(a){return b.encMap[a]||""})},b.arg="o",b.helper=",print=function(s,e){_s+=e?(s==null?'':s):_e(s);},include=function(s,d){_s+=t(s,d);}","function"==typeof define&&define.amd?define(function(){return b}):a.t=b}(this);
function n(a,b,c,d){var e=2;var f=new Array();if(b>=c){b=Math.max(0,c-((c%d)==0?d:(c%d)));}else{b=Math.max(0,b-(b%d))}var g='<a class="pagenav" href="'+a+'{%=o.h%}">{%=o.i%}</a>';f.push(b==0?'':t(g,{'h':b/d,'i':'<<'}));if(b>d*e){f.push(t(g,{'h':1,'i':'1'}));}if(b>d*(e+1)){f.push('<span style="font-weight: bold;">...</span>')}for(j=e;j>=1;j--){if(b>=d*j){k=b-d*j;f.push(t(g,{'h':k/d+1,'i':k/d+1}))}}f.push('<span class="currentpage"><b>'+(b/d+1)+'</b></span>');var l=parseInt((c-1)/d)*d;for(j=1;j<=e;j++){if(b+d*j<=l){k=b+d*j;f.push(t(g,{'h':k/d+1,'i':k/d+1}))}}if(b+d*(e+1)<l){f.push('<span style="font-weight: bold;">...</span>')}if(b+d*e<l){f.push(t(g,{'h':l/d+1,'i':l/d+1}))}if(b+d<c){m=(b+d)>c?c:(b/d+2);f.push(t(g,{'h':m,'i':'>>'}))}return f.join(' ')};
var start=0;
var total;
if(browser=='web'){var audio=new Audio($('body').attr('basesrc') + '/assets/odIeERVR1c5.mp3');}else{navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;};
var alert=true;
$(function(){
$('#chat').submit(function(e){e.preventDefault();len=$('#chat_input').val().length;if(len<2||len>1023){$('#error').text('\u0110\u1ed9 d\xe0i tin nh\u1eafn l\xe0 t\u1eeb 2 \u0111\u1ebfn 1023 k\xfd t\u1ef1!').fadeIn(200).delay(2000).fadeOut(1);return}$('#chat_submit').val('\u0110ang g\u1eedi...').attr('disabled','');$.post('request.php?act=send_chat',$(this).serialize(),function(data){if(data.status==417){$('#error').text(data.res).fadeIn(200).delay(2000).fadeOut(1);}else if(data.res==1){$('#chatbox').empty().html('<div class="list2"><b><a href="users/profile.php?user=2" title="V\u1eeba xong">BOT</a></b>: \u0111\xe3 l\xe0m s\u1ea1ch chatbox</div>');$('#total').text('1');if(headmod=='chatroom')$('#pagination').empty().hide();start=0;}else{start=0;alert=false;update_chatbox();}$('#chat_submit').val('G\u1eedi').removeAttr('disabled','');$('#chat_input').val('');})})
$('#pagination').delegate('a','click',function(e){e.preventDefault();var url=$(this).attr('href');var myRegexp=/chat\.php\?page=([\d]+?)(?:&|$)/g;var match=myRegexp.exec(url);var page=match[1];start=(parseInt(page)-1)*user.kmess;if(start>total){alert('N\u1ed9i dung \u0111\xe3 h\u1ebft!');return;}update_chatbox();})
if(browser=='web'){$('#chat_input').keypress(function(e){if((e.keyCode == 10 || e.keyCode == 13) && !e.shiftKey){e.preventDefault();$('#chat').trigger('submit')}})}
if(headmod=='chatroom')$('#pagination:empty').hide();})
function update_chatbox(){if(autoload){clearTimeout(autoload);}$.get('request.php?r='+Math.random(),{act:'load_chat',start:start,do:headmod},function(data){if(data.status==417){$('#error').text(data.res).fadeIn(200).delay(2000).fadeOut(1);}else{$('#chatbox').html(t('{% for (var i=0;i<o.message.length;i++) { %}<div class="list{% if(i%2){ %}1{% }else{ %}2{% } %}"><b><a href="users/profile.php?user={%=o.message[i].uid%}" title="{%=o.message[i].time%}">{% print(o.message[i].author, true); %}</a></b>: {% print(o.message[i].text, true); %}</div>{% } %}',data));if(total!=undefined&&total!=data.total&&alert==true&&user.id){if(browser=='web'){audio.play();}else if(navigator.vibrate){navigator.vibrate(500);}}alert=true;total=data.total;$('#total').text(total);start=data.start;if(headmod=='chatroom'&&total>start&&total>user.kmess){paging=n('chat.php?page=',start,total,user.kmess);$('#pagination').html(paging).show();}}})
autoload=setInterval(update_chatbox,10000);}if(headmod=='mainpage'||headmod=='chatroom'){autoload=setInterval(update_chatbox,10000);}